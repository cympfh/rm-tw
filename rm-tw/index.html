<title>rm tw</title>
<script src="/socket.io/socket.io.js"></script>
<style>
.tw {
  display: block;
  width: 400px;
  border: 1px aqua solid;
  background-color: #fafaff;
  font-size: 12px;
  padding: 5px;
}
</style>
<script>

var ID = "@ID@";

var tl = [];

var socket = io.connect('http://unddich.herokuapp.com/');
socket.on('data', function (datum) {

  tl = datum;
  for (var i=0; i < tl.length; ++i)
    tl[i]['del'] = false;

  for (var i=0; i < tl.length; ++i) {
    var d = tl[i];

    var t = document.createElement('div');
    t.className = "tw";
    t.id = "tw" + i;
    t.innerHTML = d.text + ' / ' + d.sid;
    t.style.position = "relative";
    t.style.left = "0";
    t.style.top = "0";

    t.onclick = function() {
      click(this.id);
      return false;
    }

    X.appendChild(t);
  }
});

function click(id) {
  var idx = +id.slice(2)
  if (tl[idx].del) {
    tl[idx].del = false;
    document.getElementById(id).style.left = 0;
  } else {
    tl[idx].del = true;
    document.getElementById(id).style.left = "50px";
  }
}

function refresh() {
  X.innerHTML = "";
  socket.emit('update', { ID : ID });
}

function erase() {
  var ret = [];
  for (var i=0; i < tl.length; ++i) {
    if (tl[i].del) {
      var obj = document.getElementById("tw" + i);
      obj.style.backgroundColor = "#fffafa"
      obj.style.border = "#ffdada";
    }
    ret.push(tl[i].sid);
  }
  socket.emit("destroy", { ID: ID, sids: ret});
  console.log(ret);
}

</script>
<body onload="refresh()">
<code>click tweets to erase</code>
<div id=X></div>
<hr>
<input type="button" value="refresh" onclick="refresh()">
<input type="button" value="erase" onclick="erase()">
<hr>
<pre>
説明した
---
[refresh]は改めて最近20件を取る
右にスライドされたツイートを[erase]で消す
いちいち確認はしない
